> * æ ‡ç­¾ï¼šKotlinã€JavaScriptã€Flutterã€å®‰å“

# åŸºäº Discuz X ç³»ç»Ÿçš„è®ºå›æ‰‹æœºç‰ˆåº”ç”¨æ„å»ºï½œé¡¹ç›®å¤ç›˜

## æ€»å¾—èŠç‚¹å¤©å…ˆå§

è¯´å®åœ¨çš„ï¼Œæˆ‘ä¹Ÿä¸çŸ¥é“æ˜¯ä»€ä¹ˆä¿ƒä½¿æˆ‘æŠ•å…¥åˆ°åº”ç”¨ç¨‹åºçš„å¼€å‘ä¹‹ä¸­ã€‚ä¼¼ä¹ä¸€å¼€å§‹æ˜¯ [HumanBeingXenon](https://github.com/HumanBeingXenon) ä»¥åŠä¸€ä¼—è®ºå›æœ‹å‹ä»¬åœ¨çœ‹åˆ°æˆ‘å¼€å‘äº† [GZMTRï¼Œè¿™ä¸ªé¡¹ç›®ç°åœ¨ä»£ç è¢«æ··æ·†è¿‡äº†ï¼Œå¹¶ä¸”å¼ƒå‘äº†](https://github.com/PassionPenguin/GZMTR)åº”ç”¨ç¨‹åºä¹‹åï¼Œå¸Œæœ›æˆ‘åšå‡ºä¸€æ¬¾åº”ç”¨ç¨‹åºï¼Œä»¥ä»£æ›¿ Discuz X å¯æ€œçš„æ‰‹æœºç‰ˆç½‘é¡µè§†å›¾ã€‚

æˆ‘å®é™…ä¸Šæ˜¯ä¸ªè®ºå›çš„æ´»è·ƒerï¼Œç­‰çº§åœ¨è®ºå›è¿è¥çš„ 20 å¹´å†…ä¹Ÿèƒ½æ’å‰å‡ äº†ï¼ˆè™½ç„¶æˆ‘åªæ³¨å†Œäº†ä¸åˆ°ä¸€å¹´ï¼‰ï¼Œä¹Ÿæ˜¯ä¸€ä¸ªæ— åçš„ã€Web å‰ç«¯ã€‘å¼€å‘è€…ã€‚

## èƒŒæ™¯æœ‰äº›å•¥

### ç°å­˜çš„ä¸»è¦é—®é¢˜åœ¨ä¹

* æ¸²æŸ“å†…å®¹å°‘ï¼ˆå¤§é‡çš„æ ·å¼æ ‡ç­¾åœ¨ç§»åŠ¨ç«¯éƒ½è¢«å¿½ç•¥æ‰äº†ï¼‰
* åŠŸèƒ½å°‘ï¼ˆå°‘äº†è¯„åˆ†ï¼ˆåŠ å‡åˆ†ï¼‰ã€é«˜çº§æœç´¢ã€ä¼ å›¾ï¼ˆå¤šå¼ ä¼ å›¾ï¼‰ï¼‰
* åŠ è½½æ…¢ï¼ˆDiscuz X ä¼˜åŒ–æ‹‰èƒ¯ï¼‰
* å¹¿å‘Šå¤šï¼ˆ10 æ¡å›å¤ï¼ŒAdBlock èƒ½å¤Ÿæ‹¦æˆª 10 æ¡å¹¿å‘Šï¼‰
* ä¸ä¼šæ¸²æŸ“ä¸ªæ€§ç­¾åä»¥åŠç¼–è¾‘ä¸ªæ€§ç­¾å

### å¸Œæœ›å®ç°çš„åŠŸèƒ½

* ç¼–è¾‘å™¨èƒ½å¤Ÿä½¿ç”¨æ ·å¼
* ä¸€æ¬¡æ€§ä¸Šä¼ å¤šå¼ ç…§ç‰‡
* å»å¹¿å‘Š
* ä¼˜åŒ–åŠ è½½ï¼ˆlazy-loading ç­‰ï¼‰
* è¡¥å›ç¼ºå¤±çš„æ¸²æŸ“å†…å®¹
* æ¸²æŸ“ä¸ªæ€§ç­¾åä»¥åŠæä¾›ç¼–è¾‘ä¸ªæ€§ç­¾åçš„å…¥å£

## æ­ªè·¯ â€”â€” èµ„æºè„šæœ¬æ³¨å…¥

é¦–å…ˆå°è¯•ç”¨æœ€æ“…é•¿çš„ Web æŠ€æœ¯å°è¯•å»æ„å»ºï¼Œäº‹å®ä¸Šï¼Œä¹Ÿæ„å»ºè¿‡å‡ ç‰ˆåº”ç”¨ç¨‹åºï¼Œå¹¶ä½¿ç”¨ [`WebView`](https://developer.android.google.cn/reference/android/webkit/WebView) æ‰“åŒ…æ•´ä¸ª Web é¡¹ç›®åŒ…ã€‚ä½†æ˜¯åœ¨å®è·µä¸­ï¼Œå‘ç°äº†ä¸å°‘é—®é¢˜ï¼Œæœ€å¤§çš„é—®é¢˜è¿˜æ˜¯é›†ä¸­åœ¨èµ„æºåŠ è½½çš„é€Ÿåº¦ â€”â€” **æ–¹å‘é€‰é”™äº†ï¼**

æˆ‘é‚£æ—¶å€™ç›´æ¥äº†å½“åœ°é€‰æ‹©äº† **èµ„æºè„šæœ¬æ³¨å…¥** çš„æ–¹æ³•ï¼Œå€ŸåŠ© [WebView.evaluateJavascript](https://developer.android.com/reference/android/webkit/WebView#evaluateJavascript(java.lang.String,%20android.webkit.ValueCallback%3Cjava.lang.String%3E)) å¾€ WebView ä¸­æ³¨å…¥ `window.onload = () => {}` å¹¶ä½¿ç”¨ JavaScript å¾€é¡µé¢å†…æ³¨å…¥è‡ªå®šä¹‰çš„ CSS ä»¥åŠæ”¹å–„çš„è„šæœ¬ã€‚

ç„¶è€Œäº‹å®è¯æ˜ï¼Œæˆ‘å¤ªå¤©çœŸäº†ã€‚WebView åŠ è½½é¡µé¢çš„é€Ÿåº¦å¥‡æ…¢ï¼Œå¤§é‡çš„å›¾ç‰‡æ²¡æœ‰æ‡’åŠ è½½ï¼Œå µå¡è¿›ç¨‹ï¼Œè®©é¡µé¢ä¸€ç›´å¤„äºåŠ è½½ä¸­çŠ¶æ€ï¼Œå¹¶ä¸”å¤§é‡çš„åŠŸèƒ½è¿˜æ˜¯ç¼ºå¤±ï¼Œå¹¶ä¸”éš¾ä»¥ä¿®æ”¹ï¼Œéš¾ä»¥è°ƒè¯•ã€‚

é‚£æ—¶å€™ï¼Œå¹³å‡ä¸€ä¸ªé¡µé¢çš„åŠ è½½æ—¶é—´ï¼ˆåŸç½‘é¡µçš„åŠ è½½æ—¶é—´ï¼‰ä¸º 16sï¼ˆ100 Mbpsï¼‰ï¼Œè€Œç”¨èœ‚çªæ•°æ®ï¼Œé‚£å°±å¯æ€•å’¯ï¼Œç›´æ¥æŠŠæˆ‘å¤´æ‰¬äº† ğŸ˜‚ï¼Œä»¤äººç—›è‹¦ = =ã€‚

ç°åœ¨è¿˜è®°å¾—è®ºå›ä¸­æœ€å¤šåé¦ˆçš„å£°éŸ³æ˜¯ï¼š

> ### ä¸€ç›´åœ¨åŠ è½½ï¼Œä»æœªæœ‰åœæ­¢
>
> â€”â€” *ç¬‘æ­»ï¼Œæ ¹æœ¬åŠ è½½ä¸å‡ºæ¥ã€‚*

## è½¬å…¥æ­£è½¨ â€”â€” åŸç”Ÿ

> æœ€è¿‘æƒ³è¦é‡æ„ï¼ˆåŸæ¥çœŸçš„å°±æ˜¯ä¸€è¾¹å­¦ä¸€è¾¹å†™ï¼Œæ€è·¯å¾ˆä¹±ï¼‰ï¼ŒåŸå§‹ä»£ç çš„ `hash` æ˜¯ `afd615412f0d0679a65faa327629fa8a80c78954`

è¿˜æ˜¯ [HumanBeingXenon](https://github.com/HumanBeingXenon) è¿™ä¸ªæ†¨æ†¨çš„æè®®ï¼Œè®©æˆ‘æœ¬å°±ä¸å……å®çš„å¯’å‡ç”Ÿæ´»æ›´åŠ ä¸å……å® = =ã€‚

ä»–é—®æˆ‘ï¼Œè¦ä¸è¦ä»¥ä»–ä¸ºå¼€å‘æ ¸å¿ƒï¼Œå¼€å‘ Java ç‰ˆçš„åº”ç”¨ç¨‹åºï¼ˆç¬‘æ­»ï¼Œä»–æ ¹æœ¬ä¸ä¼š Android å¼€å‘ - -ï¼‰ï¼Œä¼˜åŒ–ç°æœ‰çš„åº”ç”¨ç¨‹åºã€‚

æˆ‘å…ˆæ˜¯çŠ¹è±«ï¼Œæ¯•ç«Ÿåˆä¸‰çš„å¯’å‡ï¼Œæˆ‘è¿˜æƒ³ç€åˆ·ç‚¹é¢˜ç›®ï¼Œä½†æ˜¯ç†¬ä¸è¿‡ä»–çš„åŠè¯´ï¼Œæˆ‘ç«Ÿç„¶å¼€å§‹äº† = =ã€‚

è¯´å®åœ¨æˆ‘ä¹ŸçœŸçš„æ²¡æœ‰**ä»»ä½• Android å¼€å‘çš„ç»éªŒ**ï¼Œå¯ä»¥è¯´æˆ‘åœ¨å®‰å“é¢†åŸŸä¸Šå°±æ˜¯ä¸ªèŒæ–°ã€‚

æˆ‘æ˜¯å’‹å¹²çš„ï¼Ÿçœ‹ [developer.android.com](https://developer.android.com/) çš„è‹±æ–‡é¡µé¢ï¼Œä¸€è¾¹æ‘¸ç´¢åŠŸèƒ½ä¸€è¾¹æœåŠŸèƒ½ä¸€è¾¹æ‹·è´ Exception åˆ° Google å»æœç´¢ã€‚

ä¸è¿‡æˆ‘ä¸æ˜¯è®ºå›çš„ç«™é•¿ï¼Œä¹Ÿæ²¡æœ‰æƒé™åœ¨è®ºå›çš„ç³»ç»Ÿå†…æäº›ä»€ä¹ˆä¸œè¥¿ï¼Œä¹Ÿåªèƒ½å¤Ÿå€ŸåŠ©ç°æœ‰çš„æ•°æ®å»å¤„ç†äº†ã€‚

ä¾¿å¼€å§‹äº†æˆ‘çš„ `çˆ¬è™«` ç”Ÿæ¶¯ã€‚ä½¿ç”¨ [`URLConnection`](https://developer.android.google.cn/reference/java/net/URLConnection) çˆ¬å–æ•°æ®åä½¿ç”¨ [Jsoup](https://jsoup.org/) å¤„ç†æ•°æ®ã€‚æ¯å¤©çš„æ—¥å­å°±æ˜¯åœ¨è°ƒè¯•å’Œä¿®æ”¹ä¸­åº¦è¿‡ï¼Œä¸€å‘¨å†…è§£å†³äº†ä¸»è¦åŠŸèƒ½çš„å¼€å‘ï¼ŒåŸºæœ¬å®ç°äº†è®ºå›æ‰‹æœºç«¯åº”ç”¨çš„ç°ä»£åŒ–ï¼ˆdoge ğŸ¶ï¼‰ã€‚

#### åçˆ¬çš„å¤„ç†

è¯•äº†æŒºå¤š HTTP æ ‡å¤´ï¼Œä¸ç°åœ¨æˆ‘ä»¬çš„æ ¡éªŒä¸åŒï¼ˆæ¯•ç«Ÿå¤å¤ï¼‰ï¼Œå®ƒä¼šæ£€æµ‹ `User-Agent`ï¼ˆç½‘é¡µç‰ˆæœ¬ï¼‰ã€`Origin` `Referer` `Host`ï¼ˆä¸ç¡®å®šï¼Œæœ‰çš„åŠŸèƒ½ä¼šæ£€æŸ¥æœ‰çš„å´ä¸æ£€æŸ¥ï¼‰ã€`Cookie`ï¼ˆç”¨æˆ·çŠ¶æ€ï¼‰ã€‚äºæ˜¯ä¹å°±ç®€ç®€å•å•çš„ [`URLConnection.setRequestProperty`](https://developer.android.com/reference/java/net/URLConnection?hl=en#setRequestProperty(java.lang.String,%20java.lang.String)) è§£å†³æ‰è¿™ä¸ªé—®é¢˜ï¼Œç”šè‡³åæ¥æˆ‘è¿˜é¡ºä¾¿åŒ…è£…æˆäº†ä¸€ä¸ªå‡½æ•°ï¼Œç›´æ¥è¿”å› [`URLConnection`](https://developer.android.google.cn/reference/java/net/URLConnection)ï¼š

```kotlin
@WorkerThread
@Throws(NetworkOnMainThreadException::class)
private fun openConn(url: String, retrieveAsDesktopPage: Boolean): HttpURLConnection {
    val urlConnection = URL(url).openConnection() as HttpURLConnection
    urlConnection.setRequestProperty("Cookie", CookieManager.getInstance().getCookie(url) ?: "")
    urlConnection.setRequestProperty("Referer", "http://www.ditiezu.com")
    urlConnection.setRequestProperty("Origin", "http://www.ditiezu.com")
    urlConnection.setRequestProperty("Host", "www.ditiezu.com")
    urlConnection.setRequestProperty("DNT", "1")
    urlConnection.setRequestProperty("Proxy-Connection", "keep-alive")
    if (retrieveAsDesktopPage)
        urlConnection.setRequestProperty("User-Agent", userAgent)
    return urlConnection
}
```

<small>[com.passionpenguin/NetUtils.kt#L50](https://github.com/PassionPenguin/Ditiezu/blob/afd615412f0d0679a65faa327629fa8a80c78954/app/src/main/java/com/passionpenguin/NetUtils.kt#L50)</small>

#### ä¸ªæ€§ç­¾å

ç¬¬äºŒä¸ªå¤§çš„é—®é¢˜æ˜¯ä¸ªæ€§ç­¾åï¼Œä¹Ÿæ˜¯ä¸ºæ•°ä¸å¤šçš„éœ€è¦è‡ªå·±æ·±æŒ– API çš„åŠŸèƒ½ã€‚è¿™ä¸ªåŠŸèƒ½å› ä¸ºè®ºå›åœ¨æ˜¥å­£çš„æ—¶å€™é­é‡äº†å¤§é¢ç§¯çš„å¹¿å‘Šåˆ·å¸–ï¼Œæœ€åç«™é•¿ç­‰ç®¡ç†å‘˜å†³å®šå…³é—­ä¸ªäººç©ºé—´ï¼Œè€Œæ‹‰èƒ¯çš„ Discuz X ä¸ªäººç©ºé—´åŒ…å«äº†å¯†ç ã€ä¸ªäººä¿¡æ¯çš„ç¼–è¾‘é¡µé¢ï¼Œä¹Ÿé¡ºå¸¦ç€è¢« ban æ‰äº†ã€‚

ç„¶è€ŒåŒ…æ‹¬ç®¡ç†å‘˜éƒ½å¸Œæœ›é‡å¯è¿™ä¸ªåŠŸèƒ½ï¼Œå´åˆå‘ç°éš¾ä»¥æ‰¾åˆ°ä¸€ä¸ªæ–¹æ³•ã€‚æœ€åå‘äº†ä¸Šäº†åˆ°åº”ç”¨çš„æ›´æ–°å¸–ä¸­ï¼Œæˆ‘å°±å»çœ‹äº†ä¸€ä¸‹ Discuz X çš„æºä»£ç ï¼ˆä¸‹é¢çš„é“¾æ¥æ˜¯ç¬¬ä¸‰æ–¹çš„ä»“åº“ï¼‰ï¼Œå‘ç°äº†è¿™ä¸ªï¼š

```php
if($_GET['signaturenew']) {
    $signaturenew = censor($_GET['signaturenew']);
    $sightmlnew = discuzcode($signaturenew, 1, 0, 0, 0, $member['allowsigbbcode'], $member['allowsigimgcode'], 0, 0, 1);
} else {
    $sightmlnew = $signaturenew = '';
}
```

<small>[/upload/source/include/modcp/modcp_member.php#L39](https://github.com/codersclub/DiscuzX/blob/50c43cf86738f6e3a4d76b75f2ee456ede14cbd9/upload/source/include/modcp/modcp_member.php#L39)</small>

è¡¨å•çš„å¤„ç†å¾ˆæ˜¯ç®€å•ï¼Œç›´æ¥å¤„ç† POSTï¼ˆè¿™ä¸ªæ–‡ä»¶æ˜¯ç³»ç»Ÿå†…éƒ¨å—ä¿æŠ¤çš„æ–‡ä»¶ï¼Œè§ [L10](https://github.com/codersclub/DiscuzX/blob/50c43cf86738f6e3a4d76b75f2ee456ede14cbd9/upload/source/include/modcp/modcp_member.php#L10)ï¼Œæ‰€ä»¥ä¸Šé¢ä»£ç æ˜¯ GETï¼‰çš„å†…å®¹ `signaturenew`ï¼Œå› è€Œæˆ‘ä»¬ä¹Ÿåªéœ€è¦å‘é€ç”¨æˆ·ä¿¡æ¯ + `editsubmit` + `signaturenew` å³å¯ã€‚

#### å›¾ç‰‡å¤„ç†

Discuz X æ˜¯å¾ˆè¿œå¤çš„ç³»ç»Ÿï¼Œå—é™äºå¤„ç†å™¨ä»¥åŠå­˜å‚¨ç©ºé—´ï¼Œé»˜è®¤è®¾ç½®å›¾ç‰‡ä¸Šä¼ å°ºå¯¸åº”è¯¥æ˜¯ 16MPï¼Œè¶…è¿‡è¯¥å°ºå¯¸çš„å›¾ç‰‡èƒ½å¤Ÿä¸Šä¼ ï¼Œä½†ä¸ä¼šè¢«æœåŠ¡å™¨å†™å…¥ç³»ç»Ÿï¼Œåªä¼šè¿”å›é”™è¯¯ã€‚

å¸‚é¢ä¸Šå¤§å¤šæ•°çš„å›¾ç‰‡å‹ç¼©è§£å†³æ€è·¯éƒ½ä¸å¯ç”¨ â€”â€” è¦ä¹ˆå‹ç¼©åå›¾ç‰‡åè€Œå¤§å°å˜å¤§äº†ï¼Œè¦ä¹ˆæ“æ§èµ·æ¥é€Ÿåº¦å¾ˆæ…¢ã€‚

æœäº†æœ GitHubï¼Œå°±å‘ç°äº† `libjpeg-turbo` çš„è§£å†³æ€è·¯ï¼Œç®€å•çš„ç¿»è¯‘ä¸‹ï¼Œå°±æ˜¯ï¼ŒAndroid ä½¿ç”¨çš„ Skia æœ€åˆä½¿ç”¨ `libjpeg` æ—¶å€™å‡ºäºè®¾å¤‡çš„æ€§èƒ½ï¼ˆåˆæ˜¯ä½ ï¼ï¼‰è€Œå–æ¶ˆæ‰äº† Huffman ç®—æ³•çš„å‹ç¼©ï¼Œè€Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ JNI + NDKï¼Œå¯¼å…¥ä¸€ä¸ªè‡ªå·±ç¼–è¯‘è¿‡åçš„ `libjpeg` æˆ– `libjpeg-turbo` å¹¶ä¿®æ”¹æ¥å£ï¼ˆè¯è¯´ Java 16 ç°åœ¨ä¼¼ä¹ä¸ç”¨å†™ JNI æ¥å£äº†ï¼Ÿï¼‰ï¼Œå°±å¯ä»¥å®ç°å‹ç¼©åŠŸèƒ½ã€‚

> Ref: https://github.com/bither/bither-android-lib

ä¸€ç•ªæŠ˜è…¾è¿‡åï¼Œæ€»ç®—æå®šäº†è¿™ä¸ªåŠŸèƒ½ï¼Œå…·ä½“å®ç°å°±æ˜¯å…ˆ[åˆ¤æ–­å›¾ç‰‡å°ºå¯¸](https://github.com/PassionPenguin/Ditiezu/blob/afd615412f0d0679a65faa327629fa8a80c78954/app/src/main/java/com/passionpenguin/NetUtils.kt#L397)ï¼Œç„¶åè°ƒç”¨ [`NativeUtils` ç±»](https://github.com/PassionPenguin/Ditiezu/blob/afd615412f0d0679a65faa327629fa8a80c78954/app/src/main/java/net/bither/util/NativeUtil.kt#L30)ï¼Œè°ƒç”¨ JNI çš„ [`Java_net_bither_util_NativeUtil_compressBitmap`](https://github.com/PassionPenguin/Ditiezu/blob/afd615412f0d0679a65faa327629fa8a80c78954/app/src/main/jni/bitherlibjni.c#L148)å‡½æ•°ï¼Œæ‰§è¡Œå‹ç¼©ã€‚

ä¸€ç•ªæŠ˜è…¾åï¼Œè®¾ç½®å‹ç¼©æ¯”ç‡ä¸º 90%ï¼Œäº²æµ‹ä¸€èˆ¬å›¾ç‰‡éƒ½èƒ½å‹ç¼©åˆ° 10% ç”šè‡³æœ€ä½è¯•è¿‡ 5%ï¼ˆå°ç±³è®¾å¤‡æˆªå›¾ä¸ä¼˜åŒ–çš„å—ï¼ = =ï¼‰ã€‚

##### ä½†å…¶å®

ä½†å…¶å®ï¼Œå®ç°èµ·æ¥å¾ˆæ˜¯ç®€å•ï¼š

```kotlin
object NativeUtil {
    fun compressBitmap(bit: Bitmap, fileName: String, optimize: Boolean, quality: Int = 75) {
        compressBitmap(bit, quality, fileName, optimize)
    }

    private fun compressBitmap(bit: Bitmap, quality: Int, fileName: String, optimize: Boolean) {
        Log.d("native", "compress of native")
        if (bit.config != Bitmap.Config.ARGB_8888) {
            val result: Bitmap = Bitmap.createBitmap(bit.width, bit.height, Bitmap.Config.ARGB_8888)
            val canvas = Canvas(result)
            val rect = Rect(0, 0, bit.width, bit.height)
            canvas.drawBitmap(bit, null, rect, null)
            saveBitmap(result, quality, fileName, optimize)
            result.recycle()
        } else {
            saveBitmap(bit, quality, fileName, optimize)
        }
    }

    private fun saveBitmap(bit: Bitmap, quality: Int, fileName: String, optimize: Boolean) {
        compressBitmap(bit, bit.width, bit.height, quality, fileName.toByteArray(), optimize)
    }

    private external fun compressBitmap(bit: Bitmap, w: Int, h: Int, quality: Int, fileNameBytes: ByteArray, optimize: Boolean): String?

    init {
        System.loadLibrary("jpegbither")
        System.loadLibrary("bitherjni")
    }
}
```

ä»¥åŠ C++ éƒ¨åˆ†å†™ä¸€ä¸ªæ¥å£ï¼Œå‰©ä¸‹çš„ `libjpeg-turbo` ä»£ç åŸå°ä¸åŠ¨éƒ½ä¸éœ€è¦ä¿®æ”¹ = =ã€‚

#### è½¬å‘ RecyclerView

ä¸€å¼€å§‹ä½¿ç”¨çš„æ˜¯ [`ListView`](https://developer.android.google.cn/reference/android/widget/ListView)ï¼Œåœ¨å¤§é‡æ•°æ®ä¸Šé¡µé¢æåº¦è¿Ÿç¼“ï¼Œæ»‘éƒ½æ»‘ä¸å¼€ã€‚ä¸€ç•ªæœç´¢åï¼Œé€‰æ‹©ä½¿ç”¨äº† [`RecyclerView`](https://developer.android.google.cn/reference/kotlin/androidx/recyclerview/widget/RecyclerView) è§£å†³é—®é¢˜ã€‚ç°åœ¨è¿˜èƒ½æ¸…æ¥šè®°å¾—ï¼Œä¸»é¡µçš„ RecyclerView çš„ adapter åƒ[ç‹—å•ƒäº†](https://github.com/PassionPenguin/Ditiezu/blob/afd615412f0d0679a65faa327629fa8a80c78954/app/src/main/java/com/ditiezu/android/adapters/ThreadItemAdapter.kt#L61)ä¸€æ ·ï¼š

```kotlin
class ThreadItemAdapter(private val activity: Activity, items: List<ThreadItem>, private val isHomeMixed: Boolean = false) : RecyclerView.Adapter<ThreadItemAdapter.ViewHolder>() {

    private val mInflater: LayoutInflater = LayoutInflater.from(activity)
    private var mItems: List<ThreadItem> = items
    override fun getItemViewType(position: Int): Int {
        return if (position == 0 && isHomeMixed) 1 else 0
    }

    override fun onCreateViewHolder(parent: ViewGroup, viewType: Int): ViewHolder {
        return ViewHolder(mInflater.inflate(if (viewType == 1) R.layout.item_home_mixed else R.layout.item_thread_item, parent, false))
    }

    override fun getItemCount(): Int {
        return mItems.size + if (isHomeMixed) 1 else 0
    }

    class ViewHolder(view: View) : RecyclerView.ViewHolder(view) {
        var base: ViewGroup = if (view.findViewById<LinearLayout>(R.id.threadItem) != null) view.threadItem else view.homeMixed
    }

    override fun onBindViewHolder(holder: ViewHolder, position: Int) {
        if (position == 0 && isHomeMixed) {
            /* TOP BANNER SHORTCUT */
        }
        val item = mItems[position - if (isHomeMixed) 1 else 0]
        /* THREAD VIEW */
    }
}
```

è¿™ä¸ªä»£ç é‡Œé¢ç”¨äº†ä¸€å †çš„åˆ¤æ–­è¯­å¥ï¼Œæ¥åˆ¤æ–­å½“å‰ View æ˜¯ä»€ä¹ˆç±»å‹ï¼Œä»è€Œæœ‰é’ˆå¯¹çš„æ¸²æŸ“å†…å®¹ï¼Œä¸è¿‡ï¼Œä»£ç å¯è¯»æ€§å¯çœŸ"é«˜"ï¼

#### ç™»å½•

è¿™ä¸ªç°åœ¨è¿˜æ˜¯ä¸æ˜æ‰€ä»¥ç„¶ï¼Œç›®å‰ä½¿ç”¨çš„æ˜¯çœ‹ç½‘é¡µç«¯ XHR å¾—å‡ºçš„ `fastlogin` åŠŸèƒ½ï¼Œç„¶è€Œä»£ç ç€å®[å¾ˆæ··ä¹±](https://github.com/PassionPenguin/Ditiezu/blob/afd615412f0d0679a65faa327629fa8a80c78954/app/src/main/java/com/ditiezu/android/LoginActivity.kt)ï¼Œè€Œä¸”ç°åœ¨è¿˜æœ‰å¾ˆå¤šé”™è¯¯ï¼š

* éªŒè¯ç åŠ è½½
* ä¸€åˆ‡ä¿¡æ¯éƒ½æ­£ç¡®ï¼Œä½†æç¤º `è¯·è¾“å…¥ç”¨æˆ·åå’Œå¯†ç `

åæ­£æˆ‘æ˜¯æ²¡ææ‡‚ï¼Œè¿™ä¸ªé”™è¯¯ä¸ºä»€ä¹ˆåœ¨å¤šæ¬¡ç™»å½•å°è¯•ååˆèƒ½è¿›å»ï¼Ÿ

ä¸è¿‡è¿™ä¸ªé¡µé¢çš„ä»£ç æ˜¯æœ€ä¹±çš„ = =ã€‚

**ä½ çœ‹è¿™ç¼©è¿›ï¼Œå¤šä¹ˆçš„ææ€–ï¼Œå¤šä¹ˆçš„å“äººï¼ï¼ï¼**

![Screen Shot 2021-03-18 at 3.50.11 AM.png](../images/ditiezu-review.md-1c00f0afba224f29b46566c354d70247~tplv-k3u1fbpfcp-watermark.image)

## ä½ åˆ«é—®æˆ‘ä¸ºä»€ä¹ˆæˆ‘æƒ³ Flutter é‡æ„

ä¸çŸ¥é“æ˜¯ä¸‰æœˆè¿˜æ˜¯å››æœˆï¼Œè¿˜æ˜¯ä»€ä¹ˆæ—¶å€™ï¼ŒFlutter è·‘åˆ°æˆ‘çš„çœ¼çš®åº•ä¸‹ï¼Œæ„Ÿè§‰æŒºæœ‰è¶£çš„ï¼Œåˆæ˜¯ä¸€è¾¹è¯»æ–‡æ¡£ï¼ˆå½“æ—¶è¿˜ä¸çŸ¥é“æœ‰ä¸­æ–‡ç«™ï¼Œä¸è¿‡ä¸­æ–‡ç«™ä¹Ÿæ˜¯ä¸€å †æ¼æ´ï¼Œè¯»èµ·æ¥ä¸å¦‚è‹±æ–‡èˆ’æœï¼‰ï¼Œä¸€è¾¹å†™ä»£ç ã€‚

æ€è·¯å…¶å®éƒ½å·®ä¸å¤šï¼Œæœ€ç»ˆåº”ç”¨æ•ˆæœå´åƒå·®ä¸‡åˆ« â€”â€” Skia ç­‰ä¸€ä¼—ä¼˜åŒ–çš„å·¥å…·é¡ºåˆ©çš„å°†é¡µé¢åŠ¨ç”»å’Œæµç•…æ€§æé«˜å‡ ä¸ªæ•°é‡çº§ï¼Œä¹Ÿå°†å¼€å‘çš„éš¾åº¦é™ä½äº†å‡ ä¸ªæ•°é‡çº§ï¼ŒGitHub ä»“åº“åœ¨æ­¤ï¼š[Ditiezu_Flutter](https://github.com/PassionPenguin/Ditiezu_Flutter)ã€‚

å½“æ—¶ Flutter æˆ‘æ„Ÿè§‰å¾ˆä¸æˆç†Ÿï¼Œå¾ˆå¤šåŠŸèƒ½éƒ½å¤ªå°é—­äº†ï¼Œæ— å¥ˆä¸€å †åŠŸèƒ½éš¾ä»¥å®ç°ï¼Œæˆ‘ä¿®æ”¹äº† Dart å’Œ Flutter SDKï¼ˆ/usr/local/bin/flutter/â€¦â€¦ï¼‰ä»“åº“çš„æºä»£ç ï¼Œé¡ºåˆ©ç¼–è¯‘ï¼ˆè¿™çœŸçš„å¾—å¤¸ Dart å’Œ Flutter åœ¨è¿™æ–¹é¢çš„ä¼˜åŠ¿ï¼‰ã€‚

> ### æ²¡äººèƒ½å¤Ÿç¼–è¯‘æˆ‘çš„ä»“åº“çš„ä»£ç 
> 
> â€”â€” æˆ‘ä¹Ÿä¸è¡Œï¼Œå› ä¸ºæˆ‘æ›´æ–°äº† Flutterï¼Œè¦†ç›–æ‰äº† SDK çš„æ›´æ–° = =

ä¸è¿‡çœŸçš„å¾—è¯´ï¼ŒFlutter çš„ä»£ç æœ‰å‡ ä¸ªç‰¹ç‚¹ï¼š

* å¾ˆç®€æ´ï¼Œè‡³å°‘ï¼Œæ¯” Kotlinã€Java å†™èµ·æ¥è¦èˆ’æœå¾ˆå¤š
* å¾ˆæ··ä¹±ï¼Œæ¯•ç«Ÿï¼Œäººå®¶çš„å¸ƒå±€ï¼Œä¸åƒæ˜¯ HTML æ”¯æŒ CSSï¼Œå¯¼è‡´ä¸€å †æ§ä»¶å¿…é¡»äº’ç›¸å¥—å¨ƒï¼Œæ‰èƒ½å®ç°ä¸€å®šçš„æ ·å¼

### ä¸€äº›åˆšåˆšæˆªå›¾çš„ Flutter ç‰ˆæœ¬åº”ç”¨ç¨‹åºæ•ˆæœå›¾

#### ç™»å½•

![331616010065_.pic.jpg](../images/ditiezu-review.md-bf302e20f68b482392e03d04861bc8cd~tplv-k3u1fbpfcp-watermark.image)

#### é¦–é¡µ

![341616010067_.pic.jpg](../images/ditiezu-review.md-3ffb22103935402aa250ddcb3b6565bb~tplv-k3u1fbpfcp-watermark.image)

#### è´¦æˆ·

![351616010068_.pic.jpg](../images/ditiezu-review.md-6792c13bf7594e218335c721e616ee76~tplv-k3u1fbpfcp-watermark.image)

#### åˆ†åŒº

![361616010070_.pic.jpg](../images/ditiezu-review.md-a71e1223b619483dbc7fecb5d28b1ae2~tplv-k3u1fbpfcp-watermark.image)

#### æ¶ˆæ¯

![371616010073_.pic.jpg](../images/ditiezu-review.md-de8c38e5584845f18f6bd7c7fa9eaaca~tplv-k3u1fbpfcp-watermark.image)

#### çœ‹å¸–

![411616010078_.pic.jpg](../images/ditiezu-review.md-7123056efb0f40bdb10c9170d598b5f1~tplv-k3u1fbpfcp-watermark.image)

![381616010075_.pic.jpg](../images/ditiezu-review.md-26eac1a1635b4bf5b541db0c9ddde86c~tplv-k3u1fbpfcp-watermark.image)

#### åŠ åˆ†

![391616010076_.pic.jpg](../images/ditiezu-review.md-94d9fffd8cd34945bb4b0e48bc3ca55c~tplv-k3u1fbpfcp-watermark.image)

![401616010077_.pic.jpg](../images/ditiezu-review.md-e4f87f7c02754960bd6df208067e94da~tplv-k3u1fbpfcp-watermark.image)

å¤ªéš¾æˆªå›¾äº†â€¦â€¦

#### å‘å¸–

![431616010083_.pic.jpg](../images/ditiezu-review.md-5e384bc7a6a744f9a0a1bd3cca839c0f~tplv-k3u1fbpfcp-watermark.image)

![421616010079_.pic.jpg](https://p1-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/5e384bc7a6a744f9a0a1bd3cca839c0f~tplv-k3u1fbpfcp-watermark.image)

## å®Œäº‹åçš„åæ€æ€»ç»“

å…¶å®ä¸€å¼€å§‹çš„æ€è·¯ä¹Ÿä¸æ˜¯ä¸å¯è¡Œï¼Œç°åœ¨ä¹Ÿæœ‰ä¸å°‘çš„åº”ç”¨ç¨‹åºæ˜¯è¿™ä¸ªæ€è·¯å¼€å‘çš„ï¼Œä½†æ˜¯åº”è¯¥æ˜¯ä½¿ç”¨ Node.js åç«¯å¤„ç†æ•°æ®ï¼Œå‰ç«¯æ¸²æŸ“é¡µé¢ï¼Œç„¶è€Œå½“æ—¶æˆ‘åœ¨åç«¯å‰ç«¯éƒ½æ˜¯ä¸ªèŒæ–°ï¼ˆè™½ç„¶è¯´é‚£æ—¶å€™æˆ‘å·²ç»æœ‰äº†å¼€å‘çš„å±¥å†æœ‰äº†å››äº”å¹´äº†ï¼‰ã€‚

ç„¶ååˆ° Kotlin ç‰ˆæœ¬ï¼Œæ¶æ„æ··ä¹±ï¼Œä»£ç æ··ä¹±ï¼Œåƒæäº†åˆå­¦è€…çš„ä»“åº“ä¸€æ ·ï¼ŒView å’Œ Script å¤¹æ‚åœ¨ä¸€èµ·ï¼Œæ··ä¹±çš„ä¸èƒ½ä¸å¤¸ã€‚

Flutter ç‰ˆæœ¬ä¹Ÿæ˜¯ä¸€æ ·ï¼Œæ¶æ„æ··ä¹±ï¼Œä»£ç æ··ä¹±ï¼Œåƒæäº†åˆå­¦è€…çš„ä»“åº“ä¸€æ ·ï¼ŒWidget å’Œ Script å¤¹æ‚åœ¨ä¸€èµ·ï¼Œæ··ä¹±çš„ä¸èƒ½ä¸å¤¸ã€‚

ä¸‰ç§æ€è·¯å…¶å®éƒ½æœ‰ç€å…±åŒç‚¹ï¼š

* æˆ‘çš„æ¶æ„åº”è¯¥ä¼˜åŒ–ä¸€ä¸‹
* æˆ‘çš„ä»£ç åº”è¯¥æœ‰æ›´å¤šçš„æ³¨é‡Š
* æˆ‘çš„ä»£ç åº”è¯¥ä¸¥æ ¼çš„å°†åŠŸèƒ½åˆ†å¼€ï¼Œä¸è¦å †åœ¨ä¸€èµ·

### æ”¶è·çš„ä¸œè¥¿å§

åœ¨ä»¥ä¸Šæ‰€æœ‰å°è¯•ä¸­ï¼Œæˆ‘éƒ½æ˜¯ä»¥å…¨æ ˆçš„å½¢å¼ï¼Œå‚ä¸åˆ°å¼€å‘ä¸­ï¼Œç”šè‡³ [HumanBeingXenon](https://github.com/HumanBeingXenon) è‡³ä»Šä¹Ÿæ²¡æœ‰ commit ä»»ä½•ä¸€æ®µä»£ç ã€‚æˆ‘åŒ…æ½äº†è®¾è®¡ã€ç»˜å›¾ï¼ˆçŸ¢é‡å›¾å›¾æ ‡ + Banner + â€¦â€¦ï¼‰ã€æ„æ€ã€ç¼–ç¨‹ã€éƒ¨ç½²ã€è¿ç»´ã€‚

ä¹Ÿæ­£æ˜¯è¿™æ®µç»å†ï¼Œæˆ‘ç¡®å®åœ¨åˆä¸‰è¿™ä¸€å¹´ï¼Œç”±ä¸€ä¸ªåªä¼š HTML + CSS ä»¥åŠä¸€ä¸¢ä¸¢ C++ å’Œ JS çš„èŒæ–°æˆåŠŸè½¬å…¥å…¶ä»–é¢†åŸŸï¼Œæ‹“å±•äº†æˆ‘å¯¹ GitHub ç­‰å·¥å…·çš„è®¤è¯†ä»¥åŠå¯¹ä¸åŒè¯­è¨€çš„ç†è§£ã€‚

### ä¸è¿‡ï¼Œæˆ‘è¿˜æ˜¯å¾—è¯´

æˆ‘çš„ç»˜å›¾å’Œè®¾è®¡çœŸçš„ä¸‘æ­»äº† = =ã€‚

æ„Ÿè°¢ä¸€åˆ‡ä½¿ç”¨è¿‡åº”ç”¨ç¨‹åºçš„æœ‹å‹ä»¬ï¼Œä¹Ÿæ„Ÿè°¢è¿™æ¬¡æœºä¼šã€‚

* æœ¬æ–‡æ­£åœ¨å‚ä¸ã€Œæ˜é‡‘ 2021 æ˜¥æ‹›é—¯å…³æ´»åŠ¨ã€, ç‚¹å‡»æŸ¥çœ‹ [æ´»åŠ¨è¯¦æƒ…](https://juejin.cn/post/6939329638506168334)