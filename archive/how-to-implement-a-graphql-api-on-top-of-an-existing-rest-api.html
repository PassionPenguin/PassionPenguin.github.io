<!doctype html>
<html lang="en" article>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>å¦‚ä½•åŸºäºå·²æœ‰çš„ REST API å®ç° GraphQL API - Hoarfroster</title>
    <link rel="stylesheet" href="/assets/styles/post.css">
</head>
<body>
<div class="container post markdown-body"><blockquote>
<ul>
<li>åŸæ–‡åœ°å€ï¼š<a href="https://codeburst.io/how-to-implement-a-graphql-api-on-top-of-an-existing-rest-api-db8b343ddb5a">How to Implement a GraphQL API on Top of an Existing REST API</a></li>
<li>åŸæ–‡ä½œè€…ï¼š<a href="https://medium.com/@thawkin3">Tyler Hawkins</a></li>
<li>è¯‘æ–‡å‡ºè‡ªï¼š<a href="https://github.com/xitu/gold-miner">æ˜é‡‘ç¿»è¯‘è®¡åˆ’</a></li>
<li>æœ¬æ–‡æ°¸ä¹…é“¾æ¥ï¼š<a href="https://github.com/xitu/gold-miner/blob/master/article/2021/how-to-implement-a-graphql-api-on-top-of-an-existing-rest-api.md">https://github.com/xitu/gold-miner/blob/master/article/2021/how-to-implement-a-graphql-api-on-top-of-an-existing-rest-api.md</a></li>
<li>è¯‘è€…ï¼š<a href="https://github.com/samyu2000">samyu2000</a></li>
<li>æ ¡å¯¹è€…ï¼š<a href="https://github.com/PassionPenguin">PassionPenguin</a>, <a href="https://github.com/k8scat">k8scat</a></li>
</ul>
</blockquote>
<h1>å¦‚ä½•åŸºäºå·²æœ‰çš„ REST API å®ç° GraphQL API</h1>
<p><img src="https://cdn-images-1.medium.com/max/2912/0*r9_qx_t-6ltEP7GR.png" alt="Dad joke â€œdadabaseâ€ app"></p>
<p>ä½ çš„ dad jokes æ”¾åœ¨å“ªå„¿ï¼Ÿå½“ç„¶æ˜¯åœ¨ <strong>dadabase</strong> é‡Œã€‚æˆ‘ä»¬æ¥æƒ³è±¡ä¸€ä¸‹ï¼Œä½ æ˜¯å…¨ä¸–ç•Œæœ€å—æ¬¢è¿çš„ dad jokes æ•°æ®åº“çš„ç®¡ç†å‘˜ã€‚é¡¹ç›®çš„æŠ€æœ¯æ¦‚å†µæ˜¯ï¼šä½¿ç”¨ REST API ä¸æ•°æ®åº“é€šä¿¡ï¼Œè¿™ç§ REST API å…·æœ‰æœç´¢ç¬‘è¯å’Œå¯¹ç¬‘è¯è¿›è¡Œè¯„åˆ†çš„åŠŸèƒ½ï¼›ç½‘ç«™çš„è®¿é—®è€…å¯ä»¥é€šè¿‡ä¸€ä¸ªç®€å•çš„ç”¨æˆ·ç•Œé¢å¯¹æ¯æ¡ç¬‘è¯è¿›è¡Œè¯„åˆ†ã€‚</p>
<p>æœ€è¿‘ä½ äº†è§£åˆ°ä¸€ç§æ–°æŠ€æœ¯ï¼Œå®ƒå«åš GraphQLï¼Œå®ƒå…·æœ‰ä¸€å®šçš„çµæ´»æ€§ï¼Œå¯ä»¥ç²¾å‡†è·å–ä½ éœ€è¦çš„æ•°æ®ï¼Œè€Œä¸”æ˜¯ä½¿ç”¨å•ä¸€çš„ API ç»“ç‚¹ã€‚è¿™å¬ä¸Šå»å¾ˆä¸é”™ï¼Œäºæ˜¯ä½ æ‰“ç®—åœ¨åº”ç”¨ç¨‹åºä¸­ä½¿ç”¨è¿™ç§æŠ€æœ¯ã€‚ä½†æ˜¯ï¼Œä½ ä¸å¸Œæœ›å¯¹åŸæœ‰çš„ REST API ä½œè¿‡å¤šçš„æ”¹åŠ¨ã€‚èƒ½å¦è®©ä½ çš„é¡¹ç›®åŒæ—¶æ”¯æŒ REST API å’Œ GraphQL APIï¼Ÿ</p>
<p>åœ¨æœ¬æ–‡ä¸­ï¼Œæˆ‘ä»¬ä¼šè®¨è®ºå¦‚ä½•åŸºäºå·²æœ‰çš„ REST API æ¥å®ç° GraphQL APIã€‚ä½ ä½¿ç”¨è¿™ç§æ–¹æ³•ï¼Œä¸éœ€è¦å¯¹åŸºäºåŸæœ‰çš„ REST API æ¡†æ¶è¿›è¡Œè°ƒæ•´ï¼Œå°±å¯ä»¥åœ¨é¡¹ç›®çš„æœªå®Œæˆçš„æ¨¡å—ä¸­ä½¿ç”¨ GraphQLã€‚</p>
<p>å¦‚æœä½ æƒ³çœ‹åˆ°æœ€ç»ˆçš„ç»“æœï¼Œå¯ä»¥è®¿é—® <a href="https://github.com/thawkin3/dad-joke-dadabase-rest-api">REST API ä»£ç </a> å’Œ <a href="https://github.com/thawkin3/dad-joke-dadabase">å‰ç«¯å’Œ GraphQL API ä»£ç </a>ã€‚è¿˜è¦è®°å¾—<a href="https://dad-joke-dadabase.herokuapp.com/">æµè§ˆä¸€ä¸‹ç½‘ç«™</a>ï¼Œé‚£äº›ç¬‘è¯å¾ˆå€¼å¾—çœ‹å“¦ã€‚</p>
<h2>åˆå§‹æ¶æ„</h2>
<p>é¡¹ç›®çš„åå°åŸå…ˆæ˜¯ä½¿ç”¨ <a href="https://nodejs.org/en/">Node</a> å’Œ <a href="https://github.com/typicode/json-server">JSON Server</a> å¼€å‘çš„ã€‚JSON Server åˆ©ç”¨ <a href="https://expressjs.com/">Express</a> ä¸ºä¸€ä¸ªæ¨¡æ‹Ÿçš„æ•°æ®åº“æä¾›äº†å®Œæ•´çš„ REST APIï¼Œå¹¶ä¸”è¿™ä¸ªæ•°æ®åº“æ˜¯ç”±ä¸€ä¸ªç®€å•çš„ JSON æ–‡ä»¶ç”Ÿæˆçš„ã€‚å‰ç«¯æ˜¯ä½¿ç”¨ Vanilla JS å®ç°çš„ï¼Œå¹¶ä½¿ç”¨æµè§ˆå™¨å†…åµŒçš„ <a href="https://developer.mozilla.org/en-US/docs/Web/API/Fetch_API/Using_Fetch">Fetch API</a> å‘å‡º API è¯·æ±‚ã€‚è¯¥åº”ç”¨ç¨‹åºæ‰˜ç®¡åœ¨ <a href="https://devcenter.heroku.com/">Heroku</a> ä¸Šï¼Œå¯ä»¥æ–¹ä¾¿åœ°å¯¹å®ƒè¿›è¡Œéƒ¨ç½²å’Œç›‘æ§ã€‚</p>
<p>æˆ‘ä»¬ä½¿ç”¨çš„ JSON æ–‡ä»¶å«æœ‰ä¸€äº›ç¬‘è¯å’Œè¯„åˆ†ä¿¡æ¯ã€‚ä¸‹é¢ï¼Œæˆ‘ä»¬æŠŠå®ƒå®Œæ•´åœ°å¤åˆ¶å‡ºæ¥ï¼š</p>
<pre class="hljs"><code>{
  <span class="hljs-attr">&quot;jokes&quot;</span>: [
    {
      <span class="hljs-attr">&quot;id&quot;</span>: <span class="hljs-number">1</span>,
      <span class="hljs-attr">&quot;content&quot;</span>: <span class="hljs-string">&quot;I don&#x27;t often tell dad jokes, but when I do, sometimes he laughs.&quot;</span>
    },
    {
      <span class="hljs-attr">&quot;id&quot;</span>: <span class="hljs-number">2</span>,
      <span class="hljs-attr">&quot;content&quot;</span>: <span class="hljs-string">&quot;Why was the scarecrow promoted? For being outstanding in his field.&quot;</span>
    },
    {
      <span class="hljs-attr">&quot;id&quot;</span>: <span class="hljs-number">3</span>,
      <span class="hljs-attr">&quot;content&quot;</span>: <span class="hljs-string">&quot;What did the grape do when someone stepped on him? He let out a little whine.&quot;</span>
    },
    {
      <span class="hljs-attr">&quot;id&quot;</span>: <span class="hljs-number">4</span>,
      <span class="hljs-attr">&quot;content&quot;</span>: <span class="hljs-string">&quot;Einstein, Pascal, and Newton are playing hide and seek. Einstein covers his eyes and begins counting. While Pascal runs off and hides, Newton takes out some chalk and marks a square on the ground with side lengths of exactly 1 meter, then sits down inside the square. When Einstein is finished counting and sees Newton sitting on the ground, he yells, \&quot;Ha, I&#x27;ve found you, Newton!\&quot;. Newton replies, \&quot;No you haven&#x27;t! You&#x27;ve found one Newton over a square meter. You&#x27;ve found Pascal!&quot;</span>
    }
  ],
  <span class="hljs-attr">&quot;ratings&quot;</span>: [
    { <span class="hljs-attr">&quot;id&quot;</span>: <span class="hljs-number">1</span>, <span class="hljs-attr">&quot;jokeId&quot;</span>: <span class="hljs-number">1</span>, <span class="hljs-attr">&quot;score&quot;</span>: <span class="hljs-number">8</span> },
    { <span class="hljs-attr">&quot;id&quot;</span>: <span class="hljs-number">2</span>, <span class="hljs-attr">&quot;jokeId&quot;</span>: <span class="hljs-number">2</span>, <span class="hljs-attr">&quot;score&quot;</span>: <span class="hljs-number">3</span> },
    { <span class="hljs-attr">&quot;id&quot;</span>: <span class="hljs-number">3</span>, <span class="hljs-attr">&quot;jokeId&quot;</span>: <span class="hljs-number">3</span>, <span class="hljs-attr">&quot;score&quot;</span>: <span class="hljs-number">6</span> },
    { <span class="hljs-attr">&quot;id&quot;</span>: <span class="hljs-number">4</span>, <span class="hljs-attr">&quot;jokeId&quot;</span>: <span class="hljs-number">1</span>, <span class="hljs-attr">&quot;score&quot;</span>: <span class="hljs-number">7</span> },
    { <span class="hljs-attr">&quot;id&quot;</span>: <span class="hljs-number">5</span>, <span class="hljs-attr">&quot;jokeId&quot;</span>: <span class="hljs-number">2</span>, <span class="hljs-attr">&quot;score&quot;</span>: <span class="hljs-number">6</span> },
    { <span class="hljs-attr">&quot;id&quot;</span>: <span class="hljs-number">6</span>, <span class="hljs-attr">&quot;jokeId&quot;</span>: <span class="hljs-number">3</span>, <span class="hljs-attr">&quot;score&quot;</span>: <span class="hljs-number">4</span> },
    { <span class="hljs-attr">&quot;id&quot;</span>: <span class="hljs-number">7</span>, <span class="hljs-attr">&quot;jokeId&quot;</span>: <span class="hljs-number">1</span>, <span class="hljs-attr">&quot;score&quot;</span>: <span class="hljs-number">9</span> },
    { <span class="hljs-attr">&quot;id&quot;</span>: <span class="hljs-number">8</span>, <span class="hljs-attr">&quot;jokeId&quot;</span>: <span class="hljs-number">2</span>, <span class="hljs-attr">&quot;score&quot;</span>: <span class="hljs-number">10</span> },
    { <span class="hljs-attr">&quot;id&quot;</span>: <span class="hljs-number">9</span>, <span class="hljs-attr">&quot;jokeId&quot;</span>: <span class="hljs-number">3</span>, <span class="hljs-attr">&quot;score&quot;</span>: <span class="hljs-number">2</span> },
    { <span class="hljs-attr">&quot;id&quot;</span>: <span class="hljs-number">10</span>, <span class="hljs-attr">&quot;jokeId&quot;</span>: <span class="hljs-number">4</span>, <span class="hljs-attr">&quot;score&quot;</span>: <span class="hljs-number">10</span> },
    { <span class="hljs-attr">&quot;id&quot;</span>: <span class="hljs-number">11</span>, <span class="hljs-attr">&quot;jokeId&quot;</span>: <span class="hljs-number">4</span>, <span class="hljs-attr">&quot;score&quot;</span>: <span class="hljs-number">10</span> },
    { <span class="hljs-attr">&quot;id&quot;</span>: <span class="hljs-number">12</span>, <span class="hljs-attr">&quot;jokeId&quot;</span>: <span class="hljs-number">4</span>, <span class="hljs-attr">&quot;score&quot;</span>: <span class="hljs-number">10</span> },
    { <span class="hljs-attr">&quot;id&quot;</span>: <span class="hljs-number">13</span>, <span class="hljs-attr">&quot;jokeId&quot;</span>: <span class="hljs-number">4</span>, <span class="hljs-attr">&quot;score&quot;</span>: <span class="hljs-number">10</span> },
    { <span class="hljs-attr">&quot;id&quot;</span>: <span class="hljs-number">14</span>, <span class="hljs-attr">&quot;jokeId&quot;</span>: <span class="hljs-number">4</span>, <span class="hljs-attr">&quot;score&quot;</span>: <span class="hljs-number">10</span> },
    { <span class="hljs-attr">&quot;id&quot;</span>: <span class="hljs-number">15</span>, <span class="hljs-attr">&quot;jokeId&quot;</span>: <span class="hljs-number">4</span>, <span class="hljs-attr">&quot;score&quot;</span>: <span class="hljs-number">10</span> }
  ]
}
</code></pre>
<p>JSON Server ç³»ç»ŸæŠŠè¿™ä¸ªæ–‡ä»¶ä¸­çš„æ•°æ®ä½œä¸ºæ•°æ®åº“çš„åˆå§‹æ•°æ®ï¼Œæ¥ç€å®ç°ä¸€å¥— REST APIï¼Œå…¶ä¸­åŒ…æ‹¬å¯¹ GET, POST, PUT, PATCH å’Œ DELETE è¯·æ±‚çš„æ”¯æŒã€‚JSON Server çš„ç¥å¥‡ä¹‹å¤„åœ¨äºï¼Œä½¿ç”¨è¿™å¥— API å°±èƒ½å®ç°å¯¹ JSON æ–‡ä»¶çš„ä¿®æ”¹ï¼Œå› æ­¤æ•°æ®åº“å°±æ˜¯å®Œå…¨äº¤äº’å¼çš„ã€‚JSON Server ä¸ç»å®‰è£…å°±å¯ä»¥ç›´æ¥ç”± npm è„šæœ¬å¯åŠ¨ï¼Œä½†ä¸ºäº†å¯¹å®ƒè¿›è¡Œä¸€äº›é…ç½®ä»¥åŠç«¯å£çš„è®¾ç½®ï¼Œæˆ‘ä»¬å¯ä»¥å†™ä¸‹å‡ è¡Œä»£ç å¹¶è¿è¡Œå®ƒï¼Œä»£ç å¦‚ä¸‹ï¼š</p>
<pre class="hljs"><code><span class="hljs-keyword">const</span> jsonServer = <span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;json-server&#x27;</span>)
<span class="hljs-keyword">const</span> server = jsonServer.create()
<span class="hljs-keyword">const</span> router = jsonServer.router(<span class="hljs-string">&#x27;db.json&#x27;</span>)
<span class="hljs-keyword">const</span> middlewares = jsonServer.defaults()

server.use(middlewares)
server.use(router)
server.listen(process.env.PORT || <span class="hljs-number">3000</span>, <span class="hljs-function">() =&gt;</span> {
  <span class="hljs-built_in">console</span>.log(<span class="hljs-string">`ğŸš€ JSON Server is running on port <span class="hljs-subst">${process.env.PORT || <span class="hljs-number">3000</span>}</span>`</span>)
})

</code></pre>
<p>æ¬²å¯¹è¿™ä¸ªæ¨¡æ‹Ÿçš„æ•°æ®åº“è¿›è¡Œæµ‹è¯•ï¼Œä½ å¯ä»¥æŠŠ <a href="https://github.com/thawkin3/dad-joke-dadabase-rest-api">API æœ‰å…³çš„ä»“åº“</a>å…‹éš†åˆ°æœ¬åœ°ï¼Œå¹¶è¿è¡Œ <code>npm install</code> å’Œ <code>npm start</code>ã€‚åœ¨æµè§ˆå™¨ä¸­è®¿é—® http://localhost:3000/jokes ï¼Œé¡µé¢ä¼šæ˜¾ç¤ºæ‰€æœ‰çš„ç¬‘è¯ã€‚è®¿é—® http://localhost:3000/ratings ï¼Œé¡µé¢ä¼šæ˜¾ç¤ºæ‰€æœ‰çš„è¯„åˆ†ä¿¡æ¯ã€‚</p>
<p><img src="https://cdn-images-1.medium.com/max/3524/0*hKZlLEM_mzlVLnLE.png" alt="/jokes API endpoint returns all the jokes when running the app locally"></p>
<p>å¤ªæ£’äº†ã€‚æˆ‘ä»¬å¯ä»¥åœ¨æµè§ˆå™¨ä¸Šè¿è¡Œåº”ç”¨ç¨‹åºçš„åå°ã€‚ç°åœ¨æˆ‘ä»¬æŠŠ API æ‰˜ç®¡åœ¨ Heroku ä¸­ã€‚é¦–å…ˆéœ€è¦<a href="https://devcenter.heroku.com/articles/heroku-cli">å®‰è£… Heroku å‘½ä»¤è¡Œå·¥å…·</a>ã€‚ç„¶åï¼Œæˆ‘ä»¬å¯ä»¥è¿›è¡Œè¿™äº›æ“ä½œï¼šç™»å½•ï¼Œåˆ›å»ºé¡¹ç›®ï¼Œæ¨é€åˆ° Heroku æœåŠ¡ç«¯ï¼Œåœ¨æµè§ˆå™¨ä¸­æ‰“å¼€é¡¹ç›®çš„æ“ä½œç•Œé¢ã€‚</p>
<pre class="hljs"><code><span class="hljs-comment"># ç™»å½•ä½ çš„ Heroku è´¦æˆ·</span>
heroku login

<span class="hljs-comment"># åˆ›å»ºé¡¹ç›®</span>
heroku create dad-joke-dadabase-rest-api

<span class="hljs-comment"># å°†ä»£ç éƒ¨ç½²åˆ° Heroku æœåŠ¡ç«¯</span>
git push heroku master

<span class="hljs-comment"># æ‰“å¼€é¡¹ç›®çš„åå°é¡µé¢</span>
heroku open
</code></pre>
<p>çœ‹ï¼Œç°åœ¨æˆ‘ä»¬æŠŠ API å‘å¸ƒåˆ°å…¬ç½‘ä¸Šäº†ï¼</p>
<p><img src="https://cdn-images-1.medium.com/max/3500/0*UG1tnsWGg6C_EyoX.png" alt="/jokes API endpoint returns all the jokes when hosting the API on Heroku"></p>
<h2>æ„å»ºç”¨æˆ·ç•Œé¢</h2>
<p>æ—¢ç„¶æˆ‘ä»¬å·²ç»éƒ¨ç½²äº†ä¸€ä¸ªè¿è¡Œä¸­çš„ REST APIï¼Œå°±å¯ä»¥åˆ¶ä½œå‰ç«¯é¡µé¢ï¼Œå¹¶ä½¿ç”¨ API æŠŠè¿™äº›ç¬‘è¯æ•°æ®å‘ˆç°åœ¨é¡µé¢ä¸Šï¼Œè¿˜å¯ä»¥å¯¹è¿™äº›ç¬‘è¯è¿›è¡Œè¯„åˆ†ã€‚ä¸‹é¢çš„ HTML é¡µé¢ä»£ç å®ç°äº†ä¸€ä¸ªæ˜¾ç¤ºç¬‘è¯å†…å®¹çš„å®¹å™¨ï¼Œç¬‘è¯å†…å®¹ç”± JavaScript ä»£ç åŠ è½½è¿›æ¥ã€‚</p>
<pre class="hljs"><code><span class="hljs-meta">&lt;!doctype <span class="hljs-meta-keyword">html</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">html</span> <span class="hljs-attr">lang</span>=<span class="hljs-string">&quot;en&quot;</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">head</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">charset</span>=<span class="hljs-string">&quot;utf-8&quot;</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;viewport&quot;</span> <span class="hljs-attr">content</span>=<span class="hljs-string">&quot;width=device-width, initial-scale=1&quot;</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">title</span>&gt;</span>Dad Joke Dadabase<span class="hljs-tag">&lt;/<span class="hljs-name">title</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;description&quot;</span> <span class="hljs-attr">content</span>=<span class="hljs-string">&quot;Where do you keep your dad jokes? In a dadabase of course!&quot;</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;author&quot;</span> <span class="hljs-attr">content</span>=<span class="hljs-string">&quot;Tyler Hawkins&quot;</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">link</span> <span class="hljs-attr">rel</span>=<span class="hljs-string">&quot;stylesheet&quot;</span> <span class="hljs-attr">href</span>=<span class="hljs-string">&quot;./style.css&quot;</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">head</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">body</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">h1</span>&gt;</span>Dad Joke Dadabase<span class="hljs-tag">&lt;/<span class="hljs-name">h1</span>&gt;</span>

  <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;project&quot;</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">h2</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;jokeContent&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">h2</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;rateThisJokeContainer&quot;</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span>Rate this joke:<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;rateThisJokeOptions&quot;</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">span</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;formGroup&quot;</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;radio&quot;</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;score-1&quot;</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;yourRating&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;1&quot;</span> /&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">label</span> <span class="hljs-attr">for</span>=<span class="hljs-string">&quot;score-1&quot;</span>&gt;</span>1<span class="hljs-tag">&lt;/<span class="hljs-name">label</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">span</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;formGroup&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;radio&quot;</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;score-2&quot;</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;yourRating&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;2&quot;</span> /&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">label</span> <span class="hljs-attr">for</span>=<span class="hljs-string">&quot;score-2&quot;</span>&gt;</span>2<span class="hljs-tag">&lt;/<span class="hljs-name">label</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">span</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;formGroup&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;radio&quot;</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;score-3&quot;</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;yourRating&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;3&quot;</span> /&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">label</span> <span class="hljs-attr">for</span>=<span class="hljs-string">&quot;score-3&quot;</span>&gt;</span>3<span class="hljs-tag">&lt;/<span class="hljs-name">label</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">span</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;formGroup&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;radio&quot;</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;score-4&quot;</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;yourRating&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;4&quot;</span> /&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">label</span> <span class="hljs-attr">for</span>=<span class="hljs-string">&quot;score-4&quot;</span>&gt;</span>4<span class="hljs-tag">&lt;/<span class="hljs-name">label</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">span</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;formGroup&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;radio&quot;</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;score-5&quot;</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;yourRating&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;5&quot;</span> /&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">label</span> <span class="hljs-attr">for</span>=<span class="hljs-string">&quot;score-5&quot;</span>&gt;</span>5<span class="hljs-tag">&lt;/<span class="hljs-name">label</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">span</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;formGroup&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;radio&quot;</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;score-6&quot;</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;yourRating&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;6&quot;</span> /&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">label</span> <span class="hljs-attr">for</span>=<span class="hljs-string">&quot;score-6&quot;</span>&gt;</span>6<span class="hljs-tag">&lt;/<span class="hljs-name">label</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">span</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;formGroup&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;radio&quot;</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;score-7&quot;</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;yourRating&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;7&quot;</span> /&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">label</span> <span class="hljs-attr">for</span>=<span class="hljs-string">&quot;score-7&quot;</span>&gt;</span>7<span class="hljs-tag">&lt;/<span class="hljs-name">label</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">span</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;formGroup&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;radio&quot;</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;score-8&quot;</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;yourRating&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;8&quot;</span> /&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">label</span> <span class="hljs-attr">for</span>=<span class="hljs-string">&quot;score-8&quot;</span>&gt;</span>8<span class="hljs-tag">&lt;/<span class="hljs-name">label</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">span</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;formGroup&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;radio&quot;</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;score-9&quot;</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;yourRating&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;9&quot;</span> /&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">label</span> <span class="hljs-attr">for</span>=<span class="hljs-string">&quot;score-9&quot;</span>&gt;</span>9<span class="hljs-tag">&lt;/<span class="hljs-name">label</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">span</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;formGroup&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;radio&quot;</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;score-10&quot;</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;yourRating&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;10&quot;</span> /&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">label</span> <span class="hljs-attr">for</span>=<span class="hljs-string">&quot;score-10&quot;</span>&gt;</span>10<span class="hljs-tag">&lt;/<span class="hljs-name">label</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span>
      <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">p</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;averageRating&quot;</span>&gt;</span>Average Rating: <span class="hljs-tag">&lt;<span class="hljs-name">span</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;jokeRatingValue&quot;</span>&gt;</span>7.8<span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;nextJoke&quot;</span>&gt;</span>See Next Joke<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">src</span>=<span class="hljs-string">&quot;./script.js&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">body</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">html</span>&gt;</span>
</code></pre>
<p>JavaScript ä»£ç å¦‚ä¸‹ã€‚è·Ÿ REST API äº¤äº’çš„å…³é”®ä»£ç åœ¨äºä¸¤ä¸ªè·å–æ•°æ®çš„è¯·æ±‚ã€‚ç¬¬ä¸€ä¸ªè¯·æ±‚é€šè¿‡è®¿é—® <code>/jokes?_embed=ratings</code> è·å–æ•°æ®åº“ä¸­æ‰€æœ‰çš„ç¬‘è¯ï¼Œç¬¬äºŒä¸ªè¯·æ±‚æ˜¯ POST ç±»å‹çš„ï¼Œå®ƒé€šè¿‡è®¿é—® <code>/ratings</code> æäº¤å¯¹æŸä¸ªç¬‘è¯çš„è¯„åˆ†ã€‚</p>
<pre class="hljs"><code><span class="hljs-keyword">const</span> jokeContent = <span class="hljs-built_in">document</span>.querySelector(<span class="hljs-string">&#x27;.jokeContent&#x27;</span>)
<span class="hljs-keyword">const</span> jokeRatingValue = <span class="hljs-built_in">document</span>.querySelector(<span class="hljs-string">&#x27;.jokeRatingValue&#x27;</span>)
<span class="hljs-keyword">const</span> nextJokeButton = <span class="hljs-built_in">document</span>.querySelector(<span class="hljs-string">&#x27;#nextJoke&#x27;</span>)

<span class="hljs-keyword">const</span> jokes = []
<span class="hljs-keyword">let</span> currentJokeIndex = -<span class="hljs-number">1</span>

<span class="hljs-keyword">const</span> displayNextJoke = <span class="hljs-function">() =&gt;</span> {
  currentJokeIndex++
  <span class="hljs-keyword">if</span> (currentJokeIndex &gt;= jokes.length) {
    currentJokeIndex = <span class="hljs-number">0</span>
  }

  <span class="hljs-keyword">const</span> joke = jokes[currentJokeIndex]

  jokeContent.textContent = joke.content

  <span class="hljs-keyword">const</span> totalScore = joke.ratings.reduce(
    <span class="hljs-function">(<span class="hljs-params">total, rating</span>) =&gt;</span> (total += rating.score),
    <span class="hljs-number">0</span>
  )
  <span class="hljs-keyword">const</span> numberOfRatings = joke.ratings.length
  <span class="hljs-keyword">const</span> averageRating = totalScore / numberOfRatings

  jokeRatingValue.textContent = averageRating.toFixed(<span class="hljs-number">1</span>)
}

<span class="hljs-keyword">const</span> submitJokeRating = <span class="hljs-function">() =&gt;</span> {
  <span class="hljs-keyword">const</span> ratingInput = <span class="hljs-built_in">document</span>.querySelector(<span class="hljs-string">&#x27;input[name=&quot;yourRating&quot;]:checked&#x27;</span>)

  <span class="hljs-keyword">if</span> (ratingInput &amp;&amp; ratingInput.value) {
    <span class="hljs-keyword">const</span> score = <span class="hljs-built_in">Number</span>(ratingInput.value)
    <span class="hljs-keyword">const</span> jokeId = jokes[currentJokeIndex].id
    <span class="hljs-keyword">const</span> postData = { jokeId, score }

    fetch(<span class="hljs-string">&#x27;/ratings&#x27;</span>, {
      <span class="hljs-attr">method</span>: <span class="hljs-string">&#x27;POST&#x27;</span>,
      <span class="hljs-attr">headers</span>: {
        <span class="hljs-string">&#x27;Content-Type&#x27;</span>: <span class="hljs-string">&#x27;application/json&#x27;</span>,
      },
      <span class="hljs-attr">body</span>: <span class="hljs-built_in">JSON</span>.stringify(postData),
    })
      .then(<span class="hljs-function"><span class="hljs-params">response</span> =&gt;</span> response.json())
      .then(<span class="hljs-function"><span class="hljs-params">responseData</span> =&gt;</span> {
        <span class="hljs-keyword">const</span> jokeToUpdate = jokes.find(<span class="hljs-function"><span class="hljs-params">joke</span> =&gt;</span> joke.id === responseData.jokeId)
        jokeToUpdate &amp;&amp; jokeToUpdate.ratings.push(responseData)
      })
      .finally(<span class="hljs-function">() =&gt;</span> {
        ratingInput.checked = <span class="hljs-literal">false</span>
        displayNextJoke()
      })
  } <span class="hljs-keyword">else</span> {
    displayNextJoke()
  }
}

nextJokeButton.addEventListener(<span class="hljs-string">&#x27;click&#x27;</span>, submitJokeRating)

fetch(<span class="hljs-string">&#x27;/jokes?_embed=ratings&#x27;</span>)
  .then(<span class="hljs-function"><span class="hljs-params">response</span> =&gt;</span> response.json())
  .then(<span class="hljs-function"><span class="hljs-params">data</span> =&gt;</span> {
    jokes.push(...data)
    displayNextJoke()
  })

</code></pre>
<p><img src="https://cdn-images-1.medium.com/max/2860/1*vYef9XCI0zejzbFj7lzEPg.png" alt="Dad joke â€œdadabaseâ€ user interface allows you to rate each joke"></p>
<h2>å®‰è£…å¹¶ä½¿ç”¨ Apollo Server</h2>
<p>è¿™æ ·ï¼Œæˆ‘ä»¬å·²ç»å®Œæˆäº†é¡¹ç›®çš„æ¶æ„ï¼šå®ƒæœ‰ä¸€ä¸ªç®€å•çš„é¡µé¢ï¼Œè¯¥é¡µé¢é€šè¿‡ REST API è·Ÿæ•°æ®åº“é€šä¿¡ã€‚é‚£ä¹ˆï¼Œæˆ‘ä»¬å¦‚ä½•ä½¿ç”¨ GraphQLï¼Ÿä½¿ç”¨ GraphQL ä¹‹å‰éœ€è¦å“ªäº›å‡†å¤‡å·¥ä½œå‘¢ï¼Ÿç¬¬ä¸€æ­¥ï¼Œæˆ‘ä»¬å®‰è£… <code>[apollo-server-express](https://www.npmjs.com/package/apollo-server-express)</code>ï¼Œå®ƒæ˜¯ä¸€ä¸ªç¨‹åºåŒ…ï¼Œç”¨äºå®ç° <a href="https://www.apollographql.com/docs/apollo-server/getting-started/">Apollo Server</a> å’Œ Express çš„é›†æˆã€‚ä¹Ÿéœ€è¦å®‰è£… <code>[apollo-datasource-rest](https://www.npmjs.com/package/apollo-datasource-rest)</code> åŒ…ï¼Œç”¨äº REST API å’Œ Apollo Server çš„é›†æˆã€‚ç„¶åï¼Œæˆ‘ä»¬æ¥é…ç½®æœåŠ¡å™¨ï¼Œéœ€è¦ç¼–å†™ä»¥ä¸‹ä»£ç ï¼š</p>
<pre class="hljs"><code><span class="hljs-keyword">const</span> express = <span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;express&#x27;</span>)
<span class="hljs-keyword">const</span> path = <span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;path&#x27;</span>)
<span class="hljs-keyword">const</span> { ApolloServer } = <span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;apollo-server-express&#x27;</span>)
<span class="hljs-keyword">const</span> JokesAPI = <span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;./jokesAPI&#x27;</span>)
<span class="hljs-keyword">const</span> RatingsAPI = <span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;./ratingsAPI&#x27;</span>)
<span class="hljs-keyword">const</span> typeDefs = <span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;./typeDefs&#x27;</span>)
<span class="hljs-keyword">const</span> resolvers = <span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;./resolvers&#x27;</span>)

<span class="hljs-keyword">const</span> app = express()
<span class="hljs-keyword">const</span> server = <span class="hljs-keyword">new</span> ApolloServer({
  typeDefs,
  resolvers,
  <span class="hljs-attr">dataSources</span>: <span class="hljs-function">() =&gt;</span> ({
    <span class="hljs-attr">jokesAPI</span>: <span class="hljs-keyword">new</span> JokesAPI(),
    <span class="hljs-attr">ratingsAPI</span>: <span class="hljs-keyword">new</span> RatingsAPI(),
  }),
})

server.applyMiddleware({ app })

app
  .use(express.static(path.join(__dirname, <span class="hljs-string">&#x27;public&#x27;</span>)))
  .get(<span class="hljs-string">&#x27;/&#x27;</span>, <span class="hljs-function">(<span class="hljs-params">req, res</span>) =&gt;</span> {
    res.sendFile(<span class="hljs-string">&#x27;index.html&#x27;</span>, { <span class="hljs-attr">root</span>: <span class="hljs-string">&#x27;public&#x27;</span> })
  })
  .get(<span class="hljs-string">&#x27;/script.js&#x27;</span>, <span class="hljs-function">(<span class="hljs-params">req, res</span>) =&gt;</span> {
    res.sendFile(<span class="hljs-string">&#x27;script.js&#x27;</span>, { <span class="hljs-attr">root</span>: <span class="hljs-string">&#x27;public&#x27;</span> })
  })
  .get(<span class="hljs-string">&#x27;/style.css&#x27;</span>, <span class="hljs-function">(<span class="hljs-params">req, res</span>) =&gt;</span> {
    res.sendFile(<span class="hljs-string">&#x27;style.css&#x27;</span>, { <span class="hljs-attr">root</span>: <span class="hljs-string">&#x27;public&#x27;</span> })
  })

app.listen({ <span class="hljs-attr">port</span>: process.env.PORT || <span class="hljs-number">4000</span> }, <span class="hljs-function">() =&gt;</span> {
  <span class="hljs-built_in">console</span>.log(<span class="hljs-string">`ğŸš€ Server ready at port <span class="hljs-subst">${process.env.PORT || <span class="hljs-number">4000</span>}</span>`</span>)
})

</code></pre>
<p>ä½ å¯ä»¥çœ‹åˆ°ï¼Œæˆ‘ä»¬é…ç½®äº† Apollo Server çš„ä¸‰ä¸ªå±æ€§ï¼š<code>typeDefs</code>, <code>resolvers</code> å’Œ <code>dataSources</code>ã€‚å…¶ä¸­ï¼Œ<code>typeDefs</code> å±æ€§åŒ…å«äº†ä¸æˆ‘ä»¬çš„ GraphQL API ç›¸å…³çš„ <a href="https://www.apollographql.com/docs/apollo-server/schema/schema/">schema</a>ï¼Œæˆ‘ä»¬åœ¨ç›¸åº”çš„åŒ…ä¸­å®šä¹‰ç¬‘è¯å’Œè¯„åˆ†çš„æ•°æ®ç±»å‹ï¼Œä»¥åŠå¦‚ä½•æŸ¥è¯¢å’Œæ›´æ–°æ•°æ®ï¼›<code>resolvers</code> å‘Šè¯‰æœåŠ¡å™¨å¦‚ä½•å¤„ç†å„ç§å„æ ·çš„æŸ¥è¯¢å’Œæ›´æ–°éœ€æ±‚ï¼Œä»¥åŠå¦‚ä½•è¿æ¥<a href="https://www.apollographql.com/docs/apollo-server/data/data-sources/">æ•°æ®æº</a>ï¼›æœ€åï¼Œ<code>dataSources</code> å¤§è‡´æè¿°äº† GraphQL API ä¸ REST API çš„å…³è”å…³ç³»ã€‚</p>
<p>ä¸‹é¢çš„ä»£ç å®šä¹‰äº† <code>Joke</code> å’Œ <code>Rating</code> æ•°æ®ç±»å‹ï¼Œä»¥åŠå¦‚ä½•æŸ¥è¯¢å’Œæ›´æ–°æ•°æ®ã€‚</p>
<pre class="hljs"><code><span class="hljs-keyword">const</span> { gql } = <span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;apollo-server-express&#x27;</span>)

<span class="hljs-keyword">const</span> typeDefs = gql<span class="hljs-string">`
  type Joke {
    id: Int!
    content: String!
    ratings: [Rating]
  }
  type Rating {
    id: Int!
    jokeId: Int!
    score: Int!
  }
  type Query {
    joke(id: Int!): Joke
    jokes: [Joke]
    rating(id: Int!): Rating
    ratings: [Rating]
  }
  type Mutation {
    rating(jokeId: Int!, score: Int!): Rating
  }
`</span>

<span class="hljs-built_in">module</span>.exports = typeDefs
</code></pre>
<p>ä¸‹é¢æ˜¯ JokesAPI ç±»çš„ä»£ç ï¼Œä¸»è¦å®šä¹‰äº†ç¬‘è¯æ•°æ®åˆ›å»ºã€æŸ¥è¯¢ã€æ›´æ–°ã€åˆ é™¤çš„æ–¹æ³•ï¼Œè¿™äº›æ–¹æ³•åˆ†åˆ«è°ƒç”¨ç›¸åº”çš„ REST API å®æ–½ç›¸å…³çš„æ•°æ®æ“ä½œã€‚</p>
<pre class="hljs"><code><span class="hljs-keyword">const</span> { RESTDataSource } = <span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;apollo-datasource-rest&#x27;</span>)

<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">JokesAPI</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">RESTDataSource</span> </span>{
  <span class="hljs-function"><span class="hljs-title">constructor</span>(<span class="hljs-params"></span>)</span> {
    <span class="hljs-built_in">super</span>()
    <span class="hljs-built_in">this</span>.baseURL = <span class="hljs-string">&#x27;https://dad-joke-dadabase-rest-api.herokuapp.com/&#x27;</span>
  }

  <span class="hljs-keyword">async</span> <span class="hljs-function"><span class="hljs-title">getJoke</span>(<span class="hljs-params">id</span>)</span> {
    <span class="hljs-keyword">return</span> <span class="hljs-built_in">this</span>.get(<span class="hljs-string">`jokes/<span class="hljs-subst">${id}</span>?_embed=ratings`</span>)
  }

  <span class="hljs-keyword">async</span> <span class="hljs-function"><span class="hljs-title">getJokes</span>(<span class="hljs-params"></span>)</span> {
    <span class="hljs-keyword">return</span> <span class="hljs-built_in">this</span>.get(<span class="hljs-string">&#x27;jokes?_embed=ratings&#x27;</span>)
  }

  <span class="hljs-keyword">async</span> <span class="hljs-function"><span class="hljs-title">postJoke</span>(<span class="hljs-params">jokeContent</span>)</span> {
    <span class="hljs-keyword">return</span> <span class="hljs-built_in">this</span>.post(<span class="hljs-string">&#x27;jokes&#x27;</span>, jokeContent)
  }

  <span class="hljs-keyword">async</span> <span class="hljs-function"><span class="hljs-title">replaceJoke</span>(<span class="hljs-params">joke</span>)</span> {
    <span class="hljs-keyword">return</span> <span class="hljs-built_in">this</span>.put(<span class="hljs-string">&#x27;jokes&#x27;</span>, joke)
  }

  <span class="hljs-keyword">async</span> <span class="hljs-function"><span class="hljs-title">updateJoke</span>(<span class="hljs-params">joke</span>)</span> {
    <span class="hljs-keyword">return</span> <span class="hljs-built_in">this</span>.patch(<span class="hljs-string">&#x27;jokes&#x27;</span>, { <span class="hljs-attr">id</span>: joke.id, joke })
  }

  <span class="hljs-keyword">async</span> <span class="hljs-function"><span class="hljs-title">deleteJoke</span>(<span class="hljs-params">id</span>)</span> {
    <span class="hljs-keyword">return</span> <span class="hljs-built_in">this</span>.delete(<span class="hljs-string">`jokes/<span class="hljs-subst">${id}</span>`</span>)
  }
}

<span class="hljs-built_in">module</span>.exports = JokesAPI
</code></pre>
<p>è¯„åˆ†æ•°æ®è·Ÿç¬‘è¯ç›¸ä¼¼ï¼Œåªæ˜¯åœ¨æ¯ä¸ªå®ä¾‹ä¸­æŠŠ â€œjokeâ€ å˜ä¸º â€œratingâ€ã€‚æ¬²è·å–è¿™éƒ¨åˆ†ä»£ç ï¼Œå¯ä»¥<a href="https://github.com/thawkin3/dad-joke-dadabase/blob/master/src/ratingsAPI.js">å‚è€ƒ GitHub ä¸Šçš„ä»£ç ä»“åº“</a>ã€‚</p>
<p>æœ€åï¼Œæˆ‘ä»¬è®¾ç½®è§£æå™¨ï¼Œåœ¨å…¶ä¸­å®šä¹‰å¦‚ä½•ä½¿ç”¨æ•°æ®æºã€‚</p>
<pre class="hljs"><code><span class="hljs-keyword">const</span> resolvers = {
  <span class="hljs-attr">Query</span>: {
    <span class="hljs-attr">joke</span>: <span class="hljs-keyword">async</span> (_source, { id }, { dataSources }) =&gt;
      dataSources.jokesAPI.getJoke(id),
    <span class="hljs-attr">jokes</span>: <span class="hljs-keyword">async</span> (_source, _args, { dataSources }) =&gt;
      dataSources.jokesAPI.getJokes(),
    <span class="hljs-attr">rating</span>: <span class="hljs-keyword">async</span> (_source, { id }, { dataSources }) =&gt;
      dataSources.ratingsAPI.getRating(id),
    <span class="hljs-attr">ratings</span>: <span class="hljs-keyword">async</span> (_source, _args, { dataSources }) =&gt;
      dataSources.ratingsAPI.getRatings(),
  },
  <span class="hljs-attr">Mutation</span>: {
    <span class="hljs-attr">rating</span>: <span class="hljs-keyword">async</span> (_source, { jokeId, score }, { dataSources }) =&gt; {
      <span class="hljs-keyword">const</span> rating = <span class="hljs-keyword">await</span> dataSources.ratingsAPI.postRating({ jokeId, score })
      <span class="hljs-keyword">return</span> rating
    },
  },
}

<span class="hljs-built_in">module</span>.exports = resolvers
</code></pre>
<p>å®Œæˆè¿™äº›æ­¥éª¤ï¼Œæˆ‘ä»¬ä¸€åˆ‡å‡†å¤‡å°±ç»ªï¼Œå¯ä»¥é€šè¿‡ Apollo Server è°ƒç”¨ GraphQL API äº†ã€‚ä¸ºäº†æŠŠæ–°çš„å‰ç«¯é¡µé¢å’Œ GraphQL API æ‰˜ç®¡åœ¨ Heroku ä¸Šï¼Œæˆ‘ä»¬éœ€è¦åˆ›å»ºå¹¶éƒ¨ç½²ç¬¬äºŒä¸ªåº”ç”¨ç¨‹åº:</p>
<pre class="hljs"><code># åˆ›å»º Heroku åº”ç”¨ç¨‹åº
heroku create dad-joke-dadabase

# æŠŠä»£ç éƒ¨ç½²åœ¨ Heroku ä¸Š
git push heroku master

# åœ¨æœ¬åœ°æ‰“å¼€ Heroku åº”ç”¨ç¨‹åº
heroku open
</code></pre>
<h2>æŠŠ API ç«¯ç‚¹åŠŸèƒ½æ”¹ä¸ºè·å–ç¬‘è¯çš„ä»£ç </h2>
<p>ä½ åº”å½“å›å¿†ä¸‹ï¼Œæˆ‘ä»¬æœ‰ä¸¤ä¸ª API ç«¯ç‚¹ä¾›å‰ç«¯é¡µé¢è°ƒç”¨ï¼šå®ƒä»¬çš„åŠŸèƒ½åˆ†åˆ«æ˜¯è·å–ç¬‘è¯å’Œæäº¤è¯„åˆ†ã€‚ç°åœ¨æˆ‘ä»¬æŠŠ REST API ä¸­è·å–ç¬‘è¯çš„ä»£ç æ”¹ä¸º GraphQL API å½¢å¼ï¼š</p>
<pre class="hljs"><code>fetch(<span class="hljs-string">&#x27;/jokes?_embed=ratings&#x27;</span>)
  .then(<span class="hljs-function"><span class="hljs-params">response</span> =&gt;</span> response.json())
  .then(<span class="hljs-function"><span class="hljs-params">data</span> =&gt;</span> {
    jokes.push(...data)
    displayNextJoke()
  })
</code></pre>
<p>æˆ‘ä»¬æŠŠä¸Šè¿°ä»£ç æ”¹ä¸ºï¼š</p>
<pre class="hljs"><code>fetch(<span class="hljs-string">&#x27;/graphql&#x27;</span>, {
  <span class="hljs-attr">method</span>: <span class="hljs-string">&#x27;POST&#x27;</span>,
  <span class="hljs-attr">headers</span>: { <span class="hljs-string">&#x27;Content-Type&#x27;</span>: <span class="hljs-string">&#x27;application/json&#x27;</span> },
  <span class="hljs-attr">body</span>: <span class="hljs-built_in">JSON</span>.stringify({
    <span class="hljs-attr">query</span>: <span class="hljs-string">`
    query GetAllJokesWithRatings {
      jokes {
        id
        content
        ratings {
          score
          id
          jokeId
        }
      }
    }
  `</span>,
  }),
})
  .then(<span class="hljs-function"><span class="hljs-params">res</span> =&gt;</span> res.json())
  .then(<span class="hljs-function"><span class="hljs-params">res</span> =&gt;</span> {
    jokes.push(...res.data.jokes)
    displayNextJoke()
  })
</code></pre>
<p>ç°åœ¨ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨æœ¬åœ°è¿è¡Œåº”ç”¨ç¨‹åºäº†ã€‚å®é™…ä¸Šï¼Œä»ç”¨æˆ·çš„è§’åº¦æ¥è¯´ï¼Œæ²¡æœ‰å‘ç”Ÿä»»ä½•å˜åŒ–ã€‚ä½†å‡å¦‚ä½ åœ¨æµè§ˆå™¨çš„å¼€å‘è€…å·¥å…·ä¸­æŸ¥çœ‹ç½‘ç»œè¯·æ±‚ï¼Œä½ ä¼šå‘ç°ï¼Œç°åœ¨è·å–ç¬‘è¯æ˜¯é€šè¿‡è®¿é—® <code>/graphql</code> ç«¯ç‚¹æ¥å®ç°çš„äº†ã€‚çœŸæ£’ï¼</p>
<p><img src="https://cdn-images-1.medium.com/max/2520/0*ketnaG9b4tR0O0O4.png" alt="The Network tab shows a request is being made to the /graphql endpoint now"></p>
<h2>æŠŠ API ç«¯ç‚¹åŠŸèƒ½æ”¹ä¸ºæäº¤è¯„åˆ†çš„ä»£ç </h2>
<p>ä¸€ä¸ª API è¯·æ±‚å·²å®Œæˆï¼Œè¿˜æœ‰ä¸€ä¸ªï¼æˆ‘ä»¬ç°åœ¨å¯¹è¯„åˆ†åŠŸèƒ½çš„ä»£ç è¿›è¡Œä¿®æ”¹ã€‚æäº¤è¯„åˆ†çš„ä»£ç åŸæ¥ç±»ä¼¼äºï¼š</p>
<pre class="hljs"><code>fetch(<span class="hljs-string">&#x27;/ratings&#x27;</span>, {
  <span class="hljs-attr">method</span>: <span class="hljs-string">&#x27;POST&#x27;</span>,
  <span class="hljs-attr">headers</span>: {
    <span class="hljs-string">&#x27;Content-Type&#x27;</span>: <span class="hljs-string">&#x27;application/json&#x27;</span>,
  },
  <span class="hljs-attr">body</span>: <span class="hljs-built_in">JSON</span>.stringify(postData),
})
  .then(<span class="hljs-function"><span class="hljs-params">response</span> =&gt;</span> response.json())
  .then(<span class="hljs-function"><span class="hljs-params">responseData</span> =&gt;</span> {
    <span class="hljs-keyword">const</span> jokeToUpdate = jokes.find(<span class="hljs-function"><span class="hljs-params">joke</span> =&gt;</span> joke.id === responseData.jokeId)
    jokeToUpdate &amp;&amp; jokeToUpdate.ratings.push(responseData)
  })
  .finally(<span class="hljs-function">() =&gt;</span> {
    ratingInput.checked = <span class="hljs-literal">false</span>
    displayNextJoke()
  })
</code></pre>
<p>ç°åœ¨æˆ‘ä»¬ä½œå¦‚ä¸‹çš„æ”¹åŠ¨ï¼Œè®©å®ƒä½¿ç”¨æˆ‘ä»¬çš„ GraphQL APIï¼š</p>
<pre class="hljs"><code>fetch(<span class="hljs-string">&#x27;/graphql&#x27;</span>, {
  <span class="hljs-attr">method</span>: <span class="hljs-string">&#x27;POST&#x27;</span>,
  <span class="hljs-attr">headers</span>: { <span class="hljs-string">&#x27;Content-Type&#x27;</span>: <span class="hljs-string">&#x27;application/json&#x27;</span> },
  <span class="hljs-attr">body</span>: <span class="hljs-built_in">JSON</span>.stringify({
    <span class="hljs-attr">query</span>: <span class="hljs-string">`
    mutation CreateRating {
      rating(jokeId: <span class="hljs-subst">${jokeId}</span>, score: <span class="hljs-subst">${score}</span>) {
        id
        score
        jokeId
      }
    }
  `</span>,
  }),
})
  .then(<span class="hljs-function"><span class="hljs-params">res</span> =&gt;</span> res.json())
  .then(<span class="hljs-function"><span class="hljs-params">res</span> =&gt;</span> {
    <span class="hljs-keyword">const</span> rating = res.data.rating
    <span class="hljs-keyword">const</span> jokeToUpdate = jokes.find(<span class="hljs-function"><span class="hljs-params">joke</span> =&gt;</span> joke.id === rating.jokeId)
    jokeToUpdate &amp;&amp; jokeToUpdate.ratings.push(rating)
  })
  .finally(<span class="hljs-function">() =&gt;</span> {
    ratingInput.checked = <span class="hljs-literal">false</span>
    displayNextJoke()
  })
</code></pre>
<p>ç»è¿‡å¿«é€Ÿæµ‹è¯•ï¼Œè¿™æ®µä»£ç ç¬¦åˆéœ€æ±‚ã€‚å†æ¬¡è¯´æ˜ï¼Œç”¨æˆ·ä½“éªŒæ²¡æœ‰å˜ï¼Œä½†ç°åœ¨æˆ‘ä»¬è¯·æ±‚æ•°æ®ä½¿ç”¨çš„éƒ½æ˜¯ <code>/graphql</code> ç«¯ç‚¹ã€‚</p>
<h2>ç»“è®º</h2>
<p>æˆ‘ä»¬åšåˆ°äº†ã€‚æˆ‘ä»¬ä»¥å·²æœ‰çš„ REST API ä¸ºåŸºç¡€ï¼ŒæˆåŠŸåœ°å®ç°äº†ä¸€ä¸ª GraphQL API ç«¯ç‚¹ã€‚å› æ­¤ï¼Œæˆ‘ä»¬ä¹Ÿèƒ½ä½¿ç”¨ GraphQL æ¥å®ç°ä¸€äº›æ ¸å¿ƒåŠŸèƒ½ï¼Œè€Œä¸”å·²æœ‰çš„åŠŸèƒ½å’ŒåŸæ¥çš„ REST API éƒ½ä¸éœ€è¦ä¿®æ”¹ã€‚å¦‚ä»Šæˆ‘ä»¬å¯ä»¥å¼ƒç”¨ REST APIï¼Œå®ƒå°†æ¥ä¹Ÿå¯èƒ½ä¼šé€€å‡ºå†å²èˆå°ã€‚</p>
<p>è™½ç„¶ dad joke æ•°æ®åº“æ˜¯å®Œå…¨è™šæ‹Ÿçš„é¡¹ç›®ï¼Œä½†å‡ ä¹æ‰€æœ‰çš„åœ¨ 2015 å¹´ GraphQL å‘å¸ƒä¼šä¹‹å‰æˆç«‹çš„ç§‘æŠ€å…¬å¸éƒ½å‘ç°ï¼šå¦‚æœä»–ä»¬æ”¹å˜æŠ€æœ¯è·¯çº¿ï¼Œä½¿ç”¨ GraphQLï¼Œä»–ä»¬è‡ªèº«çš„æƒ…å†µè·Ÿ dad jokes ä¸€æ ·ï¼Œä¹Ÿæ˜¯å¯è¡Œçš„ã€‚å¦å¤–ï¼Œè¿˜æœ‰ä¸ªå¥½æ¶ˆæ¯ï¼ŒApollo Server å±äºè¾ƒçµæ´»çš„äº§å“ï¼Œå®ƒä¹Ÿå¯ä»¥ä»åŒ…æ‹¬ REST API ç«¯ç‚¹åœ¨å†…çš„å„ç§æ•°æ®æºè·å–æ•°æ®ã€‚</p>
<blockquote>
<p>å¦‚æœå‘ç°è¯‘æ–‡å­˜åœ¨é”™è¯¯æˆ–å…¶ä»–éœ€è¦æ”¹è¿›çš„åœ°æ–¹ï¼Œæ¬¢è¿åˆ° <a href="https://github.com/xitu/gold-miner">æ˜é‡‘ç¿»è¯‘è®¡åˆ’</a> å¯¹è¯‘æ–‡è¿›è¡Œä¿®æ”¹å¹¶ PRï¼Œä¹Ÿå¯è·å¾—ç›¸åº”å¥–åŠ±ç§¯åˆ†ã€‚æ–‡ç« å¼€å¤´çš„ <strong>æœ¬æ–‡æ°¸ä¹…é“¾æ¥</strong> å³ä¸ºæœ¬æ–‡åœ¨ GitHub ä¸Šçš„ MarkDown é“¾æ¥ã€‚</p>
</blockquote>
<hr>
<blockquote>
<p><a href="https://github.com/xitu/gold-miner">æ˜é‡‘ç¿»è¯‘è®¡åˆ’</a> æ˜¯ä¸€ä¸ªç¿»è¯‘ä¼˜è´¨äº’è”ç½‘æŠ€æœ¯æ–‡ç« çš„ç¤¾åŒºï¼Œæ–‡ç« æ¥æºä¸º <a href="https://juejin.im">æ˜é‡‘</a> ä¸Šçš„è‹±æ–‡åˆ†äº«æ–‡ç« ã€‚å†…å®¹è¦†ç›– <a href="https://github.com/xitu/gold-miner#android">Android</a>ã€<a href="https://github.com/xitu/gold-miner#ios">iOS</a>ã€<a href="https://github.com/xitu/gold-miner#%E5%89%8D%E7%AB%AF">å‰ç«¯</a>ã€<a href="https://github.com/xitu/gold-miner#%E5%90%8E%E7%AB%AF">åç«¯</a>ã€<a href="https://github.com/xitu/gold-miner#%E5%8C%BA%E5%9D%97%E9%93%BE">åŒºå—é“¾</a>ã€<a href="https://github.com/xitu/gold-miner#%E4%BA%A7%E5%93%81">äº§å“</a>ã€<a href="https://github.com/xitu/gold-miner#%E8%AE%BE%E8%AE%A1">è®¾è®¡</a>ã€<a href="https://github.com/xitu/gold-miner#%E4%BA%BA%E5%B7%A5%E6%99%BA%E8%83%BD">äººå·¥æ™ºèƒ½</a>ç­‰é¢†åŸŸï¼Œæƒ³è¦æŸ¥çœ‹æ›´å¤šä¼˜è´¨è¯‘æ–‡è¯·æŒç»­å…³æ³¨ <a href="https://github.com/xitu/gold-miner">æ˜é‡‘ç¿»è¯‘è®¡åˆ’</a>ã€<a href="http://weibo.com/juejinfanyi">å®˜æ–¹å¾®åš</a>ã€<a href="https://zhuanlan.zhihu.com/juejinfanyi">çŸ¥ä¹ä¸“æ </a>ã€‚</p>
</blockquote>
</div>
<div class="footer"></div>
</body>
<script src="/assets/scripts/index.min.js"></script>
<script>init()</script>
</html>
